var WaterTank=function(e,t,a,s,r,i,n,o,l,h,u,c){this.water=null;if(o){var E=new THREE.BoxBufferGeometry(e,s,a);E.translate(0,s/2,0);var f=new THREE.MeshBasicMaterial({color:"blue",transparent:false,opacity:.8});this.water=new THREE.Mesh(E,f);this.water.castShadow=true}var p=new THREE.BoxBufferGeometry(e,t,a);p.scale(1.15,1.15,1.15);p.translate(0,t/2,0);var v=new THREE.MeshPhongMaterial({color:l||4491519,transparent:h||true,opacity:.3});this.container=new THREE.Mesh(p,v);this.obj=new THREE.Object3D;if(o)this.obj.add(this.water);this.obj.add(this.container);this.Hini=s;this.s1=r;this.s2=i;this.halfScale=r/s;this.fullScale=i/s;this.speed=n;this.stepForward=waterTankStepForward;this.stepBackward=waterTankStepBackward;this.full=false;this.fullOnce=false;this.fullEventName=c;this.halfOnce=false;this.halfEventName=u;this.reset=waterTankReset};Object.assign(WaterTank.prototype,THREE.EventDispatcher.prototype);function waterTankStepForward(){if(this.water.scale.y>this.s2&&!this.fullOnce){this.full=true;this.dispatchEvent({type:this.fullEventName,message:"Full!"});this.fullOnce=true}if(this.water.scale.y>this.s1&&!this.halfOnce){this.dispatchEvent({type:this.halfEventName,message:"Half!"});this.halfOnce=true}if(!this.full)this.water.scale.y+=this.speed}function waterTankStepBackward(){var e=this.water.scale.y;if(e<1/this.fullScale){this.full=false;this.fullOnce=false;if(e<1/this.halfScale){this.halfOnce=false}return}this.water.scale.y-=this.speed}function waterTankReset(){this.full=false;this.fullOnce=false;this.halfOnce=false}var PressureTube=function(e,t,a,s,r,i,n,o){this.Hini=a;this.Hmax=s;i=i>1?1:i;this.fullScale=i*s/a;this.speed=r;var l=new THREE.CylinderGeometry(e,e,a);l.translate(0,a/2,0);var h=new THREE.MeshPhongMaterial({color:"blue"});this.water=new THREE.Mesh(l,h);var u=new THREE.CylinderGeometry(t,t,s);u.translate(0,s/2,0);var c=new THREE.MeshPhongMaterial({color:4491519,transparent:true,opacity:.3});this.wrapper=new THREE.Mesh(u,c);this.wrapper.castShadow=true;this.obj=new THREE.Group;this.obj.add(this.water);if(n)this.obj.add(this.wrapper);else this.water.castShadow=true;this.stepForward=PTubeStepForward;this.stepBackward=PTubeStepBackward;this.reset=PTubeReset;this.full=false;this.fullEventName=o};Object.assign(PressureTube.prototype,THREE.EventDispatcher.prototype);function PTubeStepForward(){if(this.water.scale.y>this.fullScale&&!this.full){this.dispatchEvent({type:this.fullEventName,message:"Full!"});this.full=true}if(!this.full)this.water.scale.y+=this.speed}function PTubeStepBackward(){if(this.water.scale.y<1/this.fullScale){return}this.water.scale.y-=this.speed}function PTubeReset(){this.water.scale.y=1;this.full=false}var Valve=function(e,t,a,s,r,i){s=s||5;r=r||.7;i=i||"valve";var n=new THREE.Mesh(new THREE.TorusGeometry(s,r,8,8),new THREE.MeshBasicMaterial({color:"red"}));n.position.set(e,t,a);n.name=i;var o=new THREE.Mesh(new THREE.CylinderGeometry(r,r,s*2),new THREE.MeshBasicMaterial({color:"red"}));o.position.set(e,t,a);var l=new THREE.Mesh(new THREE.CylinderGeometry(r,r,s*2),new THREE.MeshBasicMaterial({color:"red"}));l.rotation.z+=Math.PI/2;l.position.set(e,t,a);this.obj=new THREE.Object3D;this.obj.add(n);this.obj.add(o);this.obj.add(l);this.open=valveOpen;this.close=valveClose};function valveOpen(){var e=this;var t=function(){e.obj.rotation.z+=Math.PI/10};var a=setInterval(t,200);var s=function(){clearInterval(a)};setTimeout(s,2e3)}function valveClose(){var e=this;var t=function(){e.obj.rotation.z-=Math.PI/10};var a=setInterval(t,200);var s=function(){clearInterval(a)};setTimeout(s,2e3)}var WaterPipe=function(e,t,a,s,r,i,n){var o=null;if(s){var l=new THREE.TubeGeometry(e,100,t,32,false);var h=new THREE.MeshPhongMaterial({map:r,transparent:true});o=new THREE.Mesh(l,h)}var u=new THREE.TubeGeometry(e,100,a,32,false);var c=new THREE.MeshPhongMaterial({color:i||4491519,transparent:n,opacity:.3});var E=new THREE.Mesh(u,c);E.castShadow=true;this.obj=new THREE.Group;if(s)this.obj.add(o);this.obj.add(E)};var ExpandablePipe=function(e,t,a,n,s,r,i,o){var l=null;var h=function(e,t,a){var s=e[t*3+0];var r=e[t*3+1];var i=e[t*3+2];if(r/n>.2){s*=2;i*=2}i+=20;a.push(s,r,i)};if(s){var u=new THREE.TubeBufferGeometry(e,100,t,32,false);resetAndSaveLocalPos(u,h,false);var c=new THREE.MeshPhongMaterial({map:r,transparent:true});l=new THREE.Mesh(u,c)}var E=new THREE.TubeBufferGeometry(e,100,a,32,false);resetAndSaveLocalPos(E,h,false);var f=new THREE.MeshPhongMaterial({color:i||4491519,transparent:o,opacity:.3});var p=new THREE.Mesh(E,f);this.obj=new THREE.Object3D;if(s)this.obj.add(l);this.obj.add(p)};var Blade=function(n,o,l,e,t,a){l=l||10;e=e||Math.PI/2;var s=function(e,t,a){var s=e[t*3+0];var r=e[t*3+1];var i=e[t*3+2];r+=o/2;i=l*r*r/o/o*(s-n/2)/n/2;a.push(s,r,i)};var r=new THREE.PlaneBufferGeometry(n,o,16,16);if(l>1)resetAndSaveLocalPos(r,s,false);var i=new THREE.MeshLambertMaterial({color:t||2263842,transparent:a||false,opacity:.3,side:THREE.DoubleSide});var h=new THREE.Mesh(r,i);h.rotation.y+=e;h.castShadow=true;this.obj=new THREE.Object3D;this.obj.add(h)};var FanBase=function(e,t,a,s,r,i,n,o){a=a||10;r=r||6;i=i||0;this.obj=new THREE.Object3D;for(var l=0;l<r;l++){var h=new Blade(e,t,a,s,n,o||false).obj;var u=l*Math.PI*2/r;h.position.x=i*Math.cos(u);h.position.y=i*Math.sin(u);h.rotation.z+=u;this.obj.add(h)}};var StatorBase=function(e,t,a,s,r,i,n,o,l,h){a=a||5;r=r||6;i=i||0;l=l||0;h=h||Math.PI*2;this.obj=new THREE.Object3D;for(var u=0;u<r;u++){var c=new Blade(e,t,a,s,n,o||false).obj;var E=u*(h-l)/r;c.position.y=i*Math.cos(E);c.position.z=i*Math.sin(E);c.rotation.x+=E;this.obj.add(c)}};var ToggleButton=function(e){var t=new THREE.BoxGeometry(10,10,5);var a=new THREE.MeshPhongMaterial({color:6710886,transparent:false});var s=new THREE.Mesh(t,a);s.position.set(0,5,0);var r=new THREE.BoxGeometry(6,6,4);var i=new THREE.MeshPhongMaterial({color:16711680,transparent:false});this.button=new THREE.Mesh(r,i);this.button.position.set(0,5,4);this.button.name=e;this.button.userData.tooltipText=e;this.obj=new THREE.Object3D;this.obj.add(s);this.obj.add(this.button);this.toggle=toggleSwitch;this.open=openSwitch;this.opened=false};function toggleSwitch(){this.opened=!this.opened;var e=this.opened?65280:16711680;this.button.material.color.set(e);if(this.opened){this.button.position.z-=2}else{this.button.position.z+=2}return this.opened}function openSwitch(e){if(e){if(this.opened)return;else this.toggle()}else{if(this.opened)this.toggle();else return}}function resetAndSaveLocalPos(e,t,a){var s=e.getAttribute("position").array;e.computeBoundingBox();var r=e.boundingBox.min.y;var i=e.boundingBox.max.y;var n=i-r;var o=e.getAttribute("position").count;var l=[];for(var h=0,u,c,E;h<o;h++){t(s,h,l)}e.getAttribute("position").array=new Float32Array(l);e.getAttribute("position").needsUpdate=true;if(a||true)e.localPosition=l}function createTextTexture(e,t){var a=new OffscreenCanvas(e.width||256,e.height||256);var s=a.getContext("2d");s.font="Bold 24px Arial";s.fillStyle=e.color||"#f00";s.fillText(t,24,24);var r=new THREE.CanvasTexture(a);r.needsUpdate=true;r.wrapS=THREE.RepeatWrapping;r.wrapT=THREE.RepeatWrapping;return r}function TextSprite(e,t){var a=new THREE.SpriteMaterial({map:createTextTexture(e,t),opacity:.8,transparent:true});return new THREE.Sprite(a)}function createTag(e,t,a){var s=document.createElement("div");s.className="label";s.textContent=e;s.style.marginTop="-1em";var r=new CSS2DObject(s);r.position.set(0,t||1,0);a.add(r);return s}